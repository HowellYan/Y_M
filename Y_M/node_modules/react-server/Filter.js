'use strict';
const url = require('url');
const controller = require('./controller');



/**
 * [filter react-server 入口]
 * @param  {[type]}   req  []
 * @param  {[type]}   res  [description]
 * @param  {Function} next [description]
 * @return {[type]}        [description]
 */
function filter(req, res, next) {
	const urlObj = url.parse(req.url, true);
	const method = req.method;
    const pathname = urlObj.pathname;

    console.log("method:"+method);

    if(method !== "GET" && method !== "POST") {
    	res.setHeader('Content-Type', 'application/json;charset=UTF-8');
  		res.write('{"code":"000001","msg":"method不支持get、post以外的请求"}');
  		res.end('');
  		return res;
    }


    //进入 controller 
    if (pathname.match(/\/controller\//)) {
    	res = controller(req, res, next);
  		return res;
    }

  	return res;
}

module.exports = filter;